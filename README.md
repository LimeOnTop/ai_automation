# AI Browser Automation Agent

[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

Автономный AI-агент для управления веб-браузером и выполнения сложных многошаговых задач с использованием OpenAI GPT-4 и Playwright.

## Содержание

- [Описание](#описание)
- [Возможности](#возможности)
- [Требования](#требования)
- [Установка](#установка)
- [Быстрый старт](#быстрый-старт)
- [Использование](#использование)
- [Архитектура](#архитектура)
- [Примеры задач](#примеры-задач)
- [API](#api)
- [Разработка](#разработка)
- [Troubleshooting](#troubleshooting)
- [Лицензия](#лицензия)

## Описание

AI Browser Automation Agent — это автономная система, которая использует большие языковые модели для понимания естественного языка и выполнения сложных задач в веб-браузере. Агент анализирует структуру страниц, принимает решения о следующих действиях и выполняет их без предварительно закодированных сценариев.

### Ключевые особенности

- **Автономность**: Агент самостоятельно планирует и выполняет задачи без жестко заданных сценариев
- **Адаптивность**: Обрабатывает ошибки и адаптируется к изменениям на страницах
- **Безопасность**: Запрашивает подтверждение перед деструктивными действиями
- **Умное извлечение данных**: Автоматически определяет структуру страницы и генерирует селекторы

## Возможности

### Автономное принятие решений
- Использует OpenAI Function Calling для планирования действий
- Анализирует контекст страницы и историю действий
- Принимает решения в реальном времени без предварительных шаблонов

### Управление браузером
- Полный контроль через Playwright
- Поддержка видимого режима (headless: false)
- Persistent sessions для сохранения авторизаций
- Автоматическое ожидание элементов и загрузки страниц

### Security Layer
- Автоматическое определение деструктивных действий
- Интерактивное подтверждение перед выполнением
- Защита от случайных удалений, оплат и отправок

### Умное извлечение информации
- Автоматическое определение интерактивных элементов
- Генерация уникальных CSS селекторов
- Фильтрация видимого контента
- Оптимизация контекста для экономии токенов

### Обработка ошибок
- Автоматическое восстановление после ошибок
- Адаптация стратегии при неудачных действиях
- Логирование истории действий для анализа

## Требования

### Системные требования
- **Go**: версия 1.24 или выше
- **Playwright**: установится автоматически при первом запуске
- **OpenAI API Key**: требуется для работы с GPT-4

### Операционная система
- macOS
- Linux
- Windows (с ограничениями)

## Установка

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd ai_automation
```

### 2. Установка зависимостей

```bash
go mod download
```

### 3. Установка Playwright браузеров

```bash
go run github.com/playwright-community/playwright-go/cmd/playwright@latest install chromium
```

Этот шаг может занять несколько минут при первом запуске.

### 4. Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```bash
cp .env.example .env
```

Отредактируйте `.env` и добавьте ваш OpenAI API ключ:

```env
OPENAI_API_KEY=<Имя_ключа>
```

Или экспортируйте переменную окружения:

```bash
export OPENAI_API_KEY="Имя_ключа"
```

## Быстрый старт

### Сборка проекта

```bash
go build -o agent main.go
```

### Запуск

```bash
./agent
```

Или без сборки:

```bash
go run main.go
```

После запуска откроется браузер и терминал. Введите задачу в терминале.

## Использование

### Базовое использование

1. Запустите агента
2. Дождитесь открытия браузера
3. Войдите в нужные аккаунты вручную (Только на первый раз, состояние уч. записей сохраняется)
4. Введите задачу в терминале

### Примеры команд в терминале

```
> Найди 3 подходящие вакансии AI-инженера на hh.ru и откликнись на них
> Закажи мне BBQ-бургер и картошку фри из того места, откуда я заказывал на прошлой неделе
> Прочитай последние 10 писем в яндекс почте и удали спам
> exit
```

### Интерактивные подсказки

Агент может запросить:
- **Дополнительную информацию**: если задача неполная
- **Подтверждение действия**: перед деструктивными операциями

Отвечайте на запросы в терминале:
- `yes` / `y` / `да` — подтвердить действие
- `no` / `n` / `нет` — отменить действие
- `continue` — продолжить выполнение задачи

## Архитектура

Проект следует принципам Clean Architecture с четким разделением слоев:

```
ai_automation/
├── domain/                    # Доменный слой
│   ├── entities/              # Бизнес-сущности
│   │   ├── agent_response.go  # Ответ агента
│   │   ├── page_element.go    # Элемент страницы
│   │   ├── page_info.go       # Информация о странице
│   │   └── pending_action.go  # Ожидающее действие
│   └── interfaces/            # Интерфейсы
│       ├── ai.go              # Интерфейс AI
│       ├── browser.go         # Интерфейс браузера
│       ├── security.go        # Интерфейс безопасности
│       └── storage.go          # Интерфейс хранилища
│
├── infrastructure/            # Инфраструктурный слой
│   ├── ai/
│   │   └── openai_client.go   # Клиент OpenAI
│   ├── browser/
│   │   └── controller.go      # Контроллер Playwright
│   ├── security/
│   │   └── security_layer.go # Слой безопасности
│   └── storage/
│       └── browser_state.go   # Хранение состояния
│
├── application/               # Слой приложения
│   └── agent/
│       └── agent.go           # Основная логика агента
│
├── presentation/              # Слой представления
│   └── terminal/
│       └── interface.go       # Терминальный интерфейс
│
├── main.go                    # Точка входа
├── go.mod                     # Зависимости
└── README.md                  # Документация
```

### Компоненты

#### Domain Layer
Определяет бизнес-логику и интерфейсы без зависимостей от внешних библиотек.

#### Infrastructure Layer
Реализует интерфейсы доменного слоя:
- **OpenAI Client**: Интеграция с OpenAI API, function calling
- **Browser Controller**: Управление браузером через Playwright
- **Security Layer**: Проверка безопасности действий
- **Storage**: Сохранение состояния и истории

#### Application Layer
Оркестрирует выполнение задач:
- **Agent**: Основная логика принятия решений и выполнения действий

#### Presentation Layer
Пользовательский интерфейс:
- **Terminal Interface**: Интерактивный терминальный интерфейс

**Особенности:**
- Автоматически обрабатывает ошибки и адаптируется
- Запрашивает подтверждение для деструктивных действий
- Ограничение: максимум 50 итераций

## Безопасность

### Security Layer

Агент автоматически определяет деструктивные действия:
- Удаление данных
- Оплата/покупка
- Отправка форм
- Подтверждение операций

Перед выполнением таких действий запрашивается подтверждение пользователя.

